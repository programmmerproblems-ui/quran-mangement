<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ©</title>
    <style>
      * {
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
      }
      body {
        background: #f5f7fa;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      header {
        background: #2d5a27;
        color: white;
        padding: 20px;
        text-align: center;
      }
      header h1 {
        font-size: 1.8rem;
        margin-bottom: 5px;
      }
      header p {
        opacity: 0.9;
        font-size: 1rem;
      }
      nav {
        display: flex;
        background: #1e3b1a;
        flex-wrap: wrap;
      }
      nav button {
        flex: 1 1 auto;
        padding: 15px 5px;
        background: none;
        border: none;
        color: white;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.2s;
        border-bottom: 3px solid transparent;
        min-width: 100px;
      }
      nav button:hover {
        background: #3a6b32;
      }
      nav button.active {
        border-bottom-color: #ffc107;
        background: #2d5a27;
        font-weight: bold;
      }
      main {
        padding: 25px;
        min-height: 400px;
      }
      .section {
        display: none;
      }
      .section.active {
        display: block;
      }
      h2 {
        color: #2d5a27;
        margin-bottom: 20px;
        border-bottom: 2px solid #e0e0e0;
        padding-bottom: 10px;
      }
      .card {
        background: #f9f9f9;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 25px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #333;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
      }
      button {
        background: #2d5a27;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 6px;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.2s;
        margin-left: 10px;
      }
      button:hover {
        background: #1e3b1a;
      }
      button.delete {
        background: #b22222;
      }
      button.delete:hover {
        background: #8b1a1a;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        padding: 12px;
        text-align: right;
        border-bottom: 1px solid #ddd;
      }
      th {
        background: #2d5a27;
        color: white;
      }
      tr:hover {
        background: #f1f1f1;
      }
      .actions button {
        padding: 6px 12px;
        margin: 2px;
        font-size: 0.85rem;
      }
      .badge {
        background: #ffc107;
        color: #333;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
      }
      .info-text {
        color: #666;
        font-style: italic;
        margin-bottom: 15px;
      }
      .score-input {
        width: 80px;
        display: inline-block;
        margin-left: 10px;
      }
      .score-group {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 15px;
      }
      .score-label {
        min-width: 100px;
      }
      @media (max-width: 600px) {
        nav button {
          padding: 10px 2px;
          font-size: 0.9rem;
        }
        .actions button {
          display: block;
          width: 100%;
          margin: 5px 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸ“– Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ©</h1>
        <p>ØªØ³Ø¬ÙŠÙ„ ÙˆØªØ­ÙƒÙŠÙ… ÙˆÙ†ØªØ§Ø¦Ø¬</p>
      </header>
      <nav>
        <button class="nav-btn active" data-section="competitions">
          ğŸ“‹ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª
        </button>
        <button class="nav-btn" data-section="contestants">
          ğŸ‘¥ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙˆÙ†
        </button>
        <button class="nav-btn" data-section="scoring">â­ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</button>
        <button class="nav-btn" data-section="results">ğŸ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
      </nav>
      <main>
        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª -->
        <div id="competitions" class="section active">
          <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</h2>
          <div class="card">
            <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
            <form id="competitionForm">
              <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</label>
                <input type="text" id="compName" required />
              </div>
              <div class="form-group">
                <label>Ø§Ù„ÙˆØµÙ</label>
                <textarea id="compDesc" rows="2"></textarea>
              </div>
              <div class="form-group">
                <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                <input type="date" id="compStart" required />
              </div>
              <div class="form-group">
                <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                <input type="date" id="compEnd" required />
              </div>
              <button type="submit">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
            </form>
          </div>
          <div class="card">
            <h3>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
            <div id="competitionsList"></div>
          </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† -->
        <div id="contestants" class="section">
          <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†</h2>
          <div class="card">
            <h3>ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ³Ø§Ø¨Ù‚ Ø¬Ø¯ÙŠØ¯</h3>
            <form id="contestantForm">
              <div class="form-group">
                <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                <input type="text" id="contestantName" required />
              </div>
              <div class="form-group">
                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="email" id="contestantEmail" required />
              </div>
              <div class="form-group">
                <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input type="tel" id="contestantPhone" />
              </div>
              <div class="form-group">
                <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</label>
                <select id="contestantCompetition" required></select>
              </div>
              <button type="submit">â• ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚</button>
            </form>
          </div>
          <div class="card">
            <h3>Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙˆÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙˆÙ†</h3>
            <div id="contestantsList"></div>
          </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª -->
        <div id="scoring" class="section">
          <h2>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h2>
          <div class="card">
            <div class="form-group">
              <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</label>
              <select id="scoreCompetitionSelect"></select>
            </div>
            <div id="scoringArea"></div>
          </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div id="results" class="section">
          <h2>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªØ±ØªÙŠØ¨</h2>
          <div class="card">
            <div class="form-group">
              <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</label>
              <select id="resultsCompetitionSelect"></select>
            </div>
            <div id="resultsDisplay"></div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ====================
      const STORAGE_KEYS = {
        COMPETITIONS: "quran_competitions",
        CONTESTANTS: "quran_contestants",
        SCORES: "quran_scores",
      };

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage Ø£Ùˆ ØªÙ‡ÙŠØ¦Ø© Ù…ØµÙÙˆÙØ§Øª ÙØ§Ø±ØºØ©
      let competitions =
        JSON.parse(localStorage.getItem(STORAGE_KEYS.COMPETITIONS)) || [];
      let contestants =
        JSON.parse(localStorage.getItem(STORAGE_KEYS.CONTESTANTS)) || [];
      let scores = JSON.parse(localStorage.getItem(STORAGE_KEYS.SCORES)) || [];

      function saveData() {
        localStorage.setItem(
          STORAGE_KEYS.COMPETITIONS,
          JSON.stringify(competitions)
        );
        localStorage.setItem(
          STORAGE_KEYS.CONTESTANTS,
          JSON.stringify(contestants)
        );
        localStorage.setItem(STORAGE_KEYS.SCORES, JSON.stringify(scores));
      }

      // Ø¯Ø§Ù„Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯
      function generateId() {
        return Date.now() + "-" + Math.random().toString(36).substr(2, 9);
      }

      // ==================== Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª ====================
      // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª
      function renderCompetitions() {
        const container = document.getElementById("competitionsList");
        if (competitions.length === 0) {
          container.innerHTML =
            '<p class="info-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø¨Ø¹Ø¯. Ø£Ø¶Ù ÙˆØ§Ø­Ø¯Ø© Ø£Ø¹Ù„Ø§Ù‡.</p>';
          return;
        }
        let html =
          "<table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>";
        competitions.forEach((comp) => {
          const now = new Date();
          const start = new Date(comp.startDate);
          const end = new Date(comp.endDate);
          let status = "Ù‚Ø§Ø¯Ù…Ø©";
          if (now >= start && now <= end) status = "Ù†Ø´Ø·Ø©";
          else if (now > end) status = "Ù…Ù†ØªÙ‡ÙŠØ©";

          html += `<tr>
                <td><strong>${comp.name}</strong><br><small>${
            comp.description || ""
          }</small></td>
                <td>${comp.startDate} Ø¥Ù„Ù‰ ${comp.endDate}</td>
                <td><span class="badge">${status}</span></td>
                <td class="actions">
                    <button class="delete" onclick="deleteCompetition('${
                      comp.id
                    }')">Ø­Ø°Ù</button>
                </td>
            </tr>`;
        });
        html += "</table>";
        container.innerHTML = html;
      }

      // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†
      function renderContestants() {
        const container = document.getElementById("contestantsList");
        if (contestants.length === 0) {
          container.innerHTML =
            '<p class="info-text">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØ³Ø§Ø¨Ù‚ÙˆÙ† Ù…Ø³Ø¬Ù„ÙˆÙ† Ø¨Ø¹Ø¯.</p>';
          return;
        }
        let html =
          "<table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ØªÙˆØ§ØµÙ„</th><th>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</th><th>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>";
        contestants.forEach((con) => {
          const comp = competitions.find((c) => c.id === con.competitionId);
          const compName = comp ? comp.name : "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©";
          const scoreExists = scores.some((s) => s.contestantId === con.id);
          const status = scoreExists ? "âœ… ØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…" : "â³ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±";
          html += `<tr>
                <td>${con.name}</td>
                <td>${con.email}<br>${con.phone || ""}</td>
                <td>${compName}</td>
                <td>${status}</td>
                <td class="actions">
                    <button class="delete" onclick="deleteContestant('${
                      con.id
                    }')">Ø­Ø°Ù</button>
                </td>
            </tr>`;
        });
        html += "</table>";
        container.innerHTML = html;
      }

      // Ù…Ù„Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
      function populateCompetitionSelects() {
        const select1 = document.getElementById("contestantCompetition");
        const select2 = document.getElementById("scoreCompetitionSelect");
        const select3 = document.getElementById("resultsCompetitionSelect");
        const activeComps = competitions.filter((c) => {
          const now = new Date();
          const start = new Date(c.startDate);
          const end = new Date(c.endDate);
          return now >= start && now <= end; // ÙÙ‚Ø· Ø§Ù„Ù†Ø´Ø·Ø© Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
        });
        let options1 = '<option value="">-- Ø§Ø®ØªØ± Ù…Ø³Ø§Ø¨Ù‚Ø© --</option>';
        let options2 = '<option value="">-- Ø§Ø®ØªØ± Ù…Ø³Ø§Ø¨Ù‚Ø© --</option>';
        let options3 = '<option value="">-- Ø§Ø®ØªØ± Ù…Ø³Ø§Ø¨Ù‚Ø© --</option>';

        competitions.forEach((comp) => {
          options1 += `<option value="${comp.id}">${comp.name}</option>`;
          options3 += `<option value="${comp.id}">${comp.name}</option>`;
        });
        activeComps.forEach((comp) => {
          options2 += `<option value="${comp.id}">${comp.name}</option>`;
        });

        if (select1) select1.innerHTML = options1;
        if (select2) select2.innerHTML = options2;
        if (select3) select3.innerHTML = options3;
      }

      // Ø¹Ø±Ø¶ Ù…Ù†Ø·Ù‚Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³Ø§Ø¨Ù‚Ø©
      function renderScoring(competitionId) {
        const area = document.getElementById("scoringArea");
        if (!competitionId) {
          area.innerHTML =
            '<p class="info-text">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³Ø§Ø¨Ù‚Ø© Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª.</p>';
          return;
        }
        const comp = competitions.find((c) => c.id === competitionId);
        if (!comp) return;

        // Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙˆÙ† ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
        const contestantsInComp = contestants.filter(
          (c) => c.competitionId === competitionId
        );
        if (contestantsInComp.length === 0) {
          area.innerHTML =
            '<p class="info-text">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØ³Ø§Ø¨Ù‚ÙˆÙ† Ù…Ø³Ø¬Ù„ÙˆÙ† ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©.</p>';
          return;
        }

        let html = `<h3>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©: ${comp.name}</h3>`;
        contestantsInComp.forEach((con) => {
          const existingScore = scores.find((s) => s.contestantId === con.id);
          html += `<div class="card" style="margin-top:15px;">
                <h4>${con.name}</h4>
                <form onsubmit="saveScore(event, '${con.id}')">
                    <div class="score-group">
                        <span class="score-label">Ø§Ù„Ø­ÙØ¸ (60):</span>
                        <input type="number" class="score-input" id="mem_${
                          con.id
                        }" min="0" max="60" step="0.1" value="${
            existingScore ? existingScore.memorization : ""
          }" required>
                    </div>
                    <div class="score-group">
                        <span class="score-label">Ø§Ù„ØªØ¬ÙˆÙŠØ¯ (30):</span>
                        <input type="number" class="score-input" id="taj_${
                          con.id
                        }" min="0" max="30" step="0.1" value="${
            existingScore ? existingScore.tajweed : ""
          }" required>
                    </div>
                    <div class="score-group">
                        <span class="score-label">Ø§Ù„ØµÙˆØª (10):</span>
                        <input type="number" class="score-input" id="voi_${
                          con.id
                        }" min="0" max="10" step="0.1" value="${
            existingScore ? existingScore.voice : ""
          }" required>
                    </div>
                    <button type="submit">${
                      existingScore ? "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø±Ø¬Ø©" : "Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø©"
                    }</button>
                </form>
            </div>`;
        });
        area.innerHTML = html;
      }

      // Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø©
      function saveScore(event, contestantId) {
        event.preventDefault();
        const mem = parseFloat(
          document.getElementById(`mem_${contestantId}`).value
        );
        const taj = parseFloat(
          document.getElementById(`taj_${contestantId}`).value
        );
        const voi = parseFloat(
          document.getElementById(`voi_${contestantId}`).value
        );
        const total = mem + taj + voi;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
        const index = scores.findIndex((s) => s.contestantId === contestantId);
        const newScore = {
          contestantId,
          memorization: mem,
          tajweed: taj,
          voice: voi,
          total,
        };
        if (index >= 0) {
          scores[index] = newScore;
        } else {
          scores.push(newScore);
        }
        saveData();
        alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø©!");
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
        const compSelect = document.getElementById("scoreCompetitionSelect");
        renderScoring(compSelect.value);
      }

      // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…Ø­Ø¯Ø¯Ø©
      function renderResults(competitionId) {
        const display = document.getElementById("resultsDisplay");
        if (!competitionId) {
          display.innerHTML =
            '<p class="info-text">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³Ø§Ø¨Ù‚Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬.</p>';
          return;
        }
        const comp = competitions.find((c) => c.id === competitionId);
        if (!comp) return;

        // Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙˆÙ† Ø§Ù„Ø°ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… Ø¯Ø±Ø¬Ø§Øª
        const contestantsInComp = contestants.filter(
          (c) => c.competitionId === competitionId
        );
        const results = [];
        contestantsInComp.forEach((con) => {
          const score = scores.find((s) => s.contestantId === con.id);
          if (score) {
            results.push({
              name: con.name,
              email: con.email,
              memorization: score.memorization,
              tajweed: score.tajweed,
              voice: score.voice,
              total: score.total,
            });
          }
        });

        if (results.length === 0) {
          display.innerHTML =
            '<p class="info-text">Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø¯Ø±Ø¬Ø§Øª Ø¨Ø¹Ø¯ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©.</p>';
          return;
        }

        // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹
        results.sort((a, b) => b.total - a.total);

        let html = `<h3>Ø§Ù„ØªØ±ØªÙŠØ¨ ÙÙŠ Ù…Ø³Ø§Ø¨Ù‚Ø©: ${comp.name}</h3>`;
        html +=
          "<table><tr><th>Ø§Ù„ØªØ±ØªÙŠØ¨</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø­ÙØ¸ (Ù¦Ù )</th><th>Ø§Ù„ØªØ¬ÙˆÙŠØ¯ (Ù¢Ù¥)</th><th>Ø§Ù„ØµÙˆØª (Ù¡Ù¥)</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ (Ù¡Ù Ù )</th></tr>";
        results.forEach((r, idx) => {
          html += `<tr>
                <td><strong>#${idx + 1}</strong></td>
                <td>${r.name}</td>
                <td>${r.memorization}</td>
                <td>${r.tajweed}</td>
                <td>${r.voice}</td>
                <td><strong>${r.total.toFixed(1)}</strong></td>
            </tr>`;
        });
        html += "</table>";
        display.innerHTML = html;
      }

      // ==================== Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ====================
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø¨Ù‚Ø©
      document
        .getElementById("competitionForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const name = document.getElementById("compName").value.trim();
          const desc = document.getElementById("compDesc").value.trim();
          const start = document.getElementById("compStart").value;
          const end = document.getElementById("compEnd").value;
          if (!name || !start || !end) return;

          const newComp = {
            id: generateId(),
            name,
            description: desc,
            startDate: start,
            endDate: end,
            createdAt: new Date().toISOString(),
          };
          competitions.push(newComp);
          saveData();
          renderCompetitions();
          populateCompetitionSelects();
          this.reset();
        });

      // Ø¥Ø¶Ø§ÙØ© Ù…ØªØ³Ø§Ø¨Ù‚
      document
        .getElementById("contestantForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const name = document.getElementById("contestantName").value.trim();
          const email = document.getElementById("contestantEmail").value.trim();
          const phone = document.getElementById("contestantPhone").value.trim();
          const compId = document.getElementById("contestantCompetition").value;
          if (!name || !email || !compId) return;

          const newContestant = {
            id: generateId(),
            name,
            email,
            phone,
            competitionId: compId,
            registeredAt: new Date().toISOString(),
          };
          contestants.push(newContestant);
          saveData();
          renderContestants();
          populateCompetitionSelects();
          this.reset();
        });

      // Ø­Ø°Ù Ù…Ø³Ø§Ø¨Ù‚Ø©
      window.deleteCompetition = function (id) {
        if (
          confirm(
            "Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙˆÙƒÙ„ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø§. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ"
          )
        ) {
          // Ø­Ø°Ù Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·ÙŠÙ† Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
          const compContestants = contestants
            .filter((c) => c.competitionId === id)
            .map((c) => c.id);
          contestants = contestants.filter((c) => c.competitionId !== id);
          scores = scores.filter(
            (s) => !compContestants.includes(s.contestantId)
          );
          competitions = competitions.filter((c) => c.id !== id);
          saveData();
          renderCompetitions();
          renderContestants();
          populateCompetitionSelects();
          // Ø¥ÙØ±Ø§Øº Ù…Ù†Ø·Ù‚ØªÙŠ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ø°Ø§ ÙƒØ§Ù†ØªØ§ ØªØ¹Ø±Ø¶Ø§Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
          document.getElementById("scoringArea").innerHTML = "";
          document.getElementById("resultsDisplay").innerHTML = "";
        }
      };

      // Ø­Ø°Ù Ù…ØªØ³Ø§Ø¨Ù‚
      window.deleteContestant = function (id) {
        if (confirm("Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ ÙˆØ¯Ø±Ø¬Ø§ØªÙ‡. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
          contestants = contestants.filter((c) => c.id !== id);
          scores = scores.filter((s) => s.contestantId !== id);
          saveData();
          renderContestants();
          // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
          const compSelect = document.getElementById("scoreCompetitionSelect");
          if (compSelect.value) renderScoring(compSelect.value);
        }
      };

      // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
      document.querySelectorAll(".nav-btn").forEach((btn) => {
        btn.addEventListener("click", function () {
          document
            .querySelectorAll(".nav-btn")
            .forEach((b) => b.classList.remove("active"));
          this.classList.add("active");
          const sectionId = this.dataset.section;
          document
            .querySelectorAll(".section")
            .forEach((s) => s.classList.remove("active"));
          document.getElementById(sectionId).classList.add("active");
        });
      });

      // Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³Ø§Ø¨Ù‚Ø© ÙÙŠ Ù‚Ø³Ù… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
      document
        .getElementById("scoreCompetitionSelect")
        .addEventListener("change", function (e) {
          renderScoring(e.target.value);
        });

      // Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³Ø§Ø¨Ù‚Ø© ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      document
        .getElementById("resultsCompetitionSelect")
        .addEventListener("change", function (e) {
          renderResults(e.target.value);
        });

      // ==================== Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆÙ„ÙŠ ====================
      renderCompetitions();
      renderContestants();
      populateCompetitionSelects();

      // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù…Ø³Ø§Ø¨Ù‚Ø§ØªØŒ Ù†Ø¶ÙŠÙ Ù†Ù…ÙˆØ°Ø¬Ø§Ù‹ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ù„Ù„Ø¹Ø±Ø¶
      if (competitions.length === 0) {
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø¨Ù‚Ø© Ù†Ù…ÙˆØ°Ø¬ÙŠØ©
        const today = new Date();
        const start = today.toISOString().split("T")[0];
        const end = new Date(today.setDate(today.getDate() + 30))
          .toISOString()
          .split("T")[0];
        const sampleComp = {
          id: generateId(),
          name: "Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù¢Ù Ù¢Ù¥",
          description: "Ù„Ø­ÙØ¸ Ø¬Ø²Ø¡ Ø¹Ù…",
          startDate: start,
          endDate: end,
          createdAt: new Date().toISOString(),
        };
        competitions.push(sampleComp);
        saveData();
        renderCompetitions();
        populateCompetitionSelects();
      }
    </script>
  </body>
</html>
